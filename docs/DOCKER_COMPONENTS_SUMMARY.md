# Docker ç»„ä»¶å®‰è£…æ–¹æ¡ˆæ€»ç»“

## ğŸ¯ æ ¸å¿ƒæ–¹æ¡ˆ

### æ¨èç”¨æˆ·ï¼š`www`
- âœ… **å®‰å…¨æ€§**ï¼šé root ç”¨æˆ·è¿è¡Œ
- âœ… **æƒé™ç®¡ç†**ï¼šç»Ÿä¸€æ–‡ä»¶æƒé™æ§åˆ¶
- âœ… **ç”Ÿäº§å°±ç»ª**ï¼šç¬¦åˆç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ

### å®‰è£…æ¶æ„
- **é…ç½®é©±åŠ¨**ï¼šåŸºäº `components/` ç›®å½•é…ç½®è‡ªåŠ¨å®‰è£…
- **ç”¨æˆ·å‹å¥½**ï¼šè‡ªåŠ¨ç”Ÿæˆå¯†ç ã€ç›®å½•æƒé™ã€ç¯å¢ƒé…ç½®
- **æ¨¡å—åŒ–**ï¼šæ”¯æŒå•ç‹¬æˆ–æ‰¹é‡å®‰è£…ç»„ä»¶

## ğŸ“‹ å¯ç”¨è„šæœ¬

| è„šæœ¬ | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `install-components.sh` | ä¸»å®‰è£…è„šæœ¬ | çµæ´»å®‰è£…ä»»æ„ç»„ä»¶ |
| `install-nginx.sh` | Nginx å®‰è£… | å•ç‹¬å®‰è£… Web æœåŠ¡ |
| `install-mysql.sh` | MySQL å®‰è£… | å•ç‹¬å®‰è£…æ•°æ®åº“ |
| `install-redis.sh` | Redis å®‰è£… | å•ç‹¬å®‰è£…ç¼“å­˜ |
| `install-mongo.sh` | MongoDB å®‰è£… | å•ç‹¬å®‰è£… NoSQL |
| `install-kafka.sh` | Kafka å®‰è£… | å•ç‹¬å®‰è£…æ¶ˆæ¯é˜Ÿåˆ— |
| `install-all-components.sh` | å…¨é‡å®‰è£… | ä¸€é”®å®‰è£…æ‰€æœ‰ç»„ä»¶ |

## ğŸš€ å¿«é€Ÿä½¿ç”¨

### åŸºæœ¬å®‰è£…
```bash
# 1. ç¡®ä¿ Docker å·²å®‰è£…
bash install-docker.sh

# 2. å®‰è£…å•ä¸ªç»„ä»¶
bash install-nginx.sh        # Web æœåŠ¡å™¨
bash install-mysql.sh        # æ•°æ®åº“
bash install-redis.sh        # ç¼“å­˜

# 3. ä¸€é”®å®‰è£…æ‰€æœ‰
bash install-all-components.sh
```

### é«˜çº§é€‰é¡¹
```bash
# æŒ‡å®šç”¨æˆ·å®‰è£…
bash install-components.sh nginx --user www

# é¢„è§ˆæ¨¡å¼ï¼ˆä¸å®é™…æ‰§è¡Œï¼‰
bash install-components.sh mysql --dry-run

# è‡ªå®šä¹‰æ•°æ®ç›®å½•
bash install-components.sh redis --data-dir /opt/data
```

## ğŸ“‚ è‡ªåŠ¨åˆ›å»ºçš„ç›®å½•ç»“æ„

```
/data/
â”œâ”€â”€ mysql/          # æ•°æ®åº“æ•°æ®
â”œâ”€â”€ redis/          # ç¼“å­˜æ•°æ®
â”œâ”€â”€ mongodb/        # NoSQL æ•°æ®
â”œâ”€â”€ kafka/          # æ¶ˆæ¯é˜Ÿåˆ—æ•°æ®
â”œâ”€â”€ nginx/          # Web æœåŠ¡æ•°æ®
â””â”€â”€ logs/           # æ‰€æœ‰æ—¥å¿—
    â”œâ”€â”€ mysql/
    â”œâ”€â”€ redis/
    â”œâ”€â”€ mongodb/
    â”œâ”€â”€ kafka/
    â””â”€â”€ nginx/
```

**æƒé™è‡ªåŠ¨é…ç½®**ï¼š
- æ‰€æœ‰è€…ï¼š`www:www`
- æƒé™ï¼š`755`

## âš™ï¸ è‡ªåŠ¨é…ç½®åŠŸèƒ½

### 1. ç¯å¢ƒå˜é‡è‡ªåŠ¨ç”Ÿæˆ
- âœ… **éšæœºå¯†ç **ï¼šMySQLã€Redisã€MongoDB å¯†ç 
- âœ… **ç”¨æˆ·é…ç½®**ï¼šPUID/PGID è‡ªåŠ¨è®¾ç½®
- âœ… **ç½‘ç»œé…ç½®**ï¼šDocker ç½‘ç»œè‡ªåŠ¨åˆ›å»º

### 2. Docker Compose é›†æˆ
- âœ… **åŸºç¡€æœåŠ¡**ï¼šä½¿ç”¨ `compose/base/docker-compose.yml`
- âœ… **ç»„ä»¶è¦†ç›–**ï¼šä½¿ç”¨ `components/{name}/override.yml`
- âœ… **é¡¹ç›®ç®¡ç†**ï¼šç»Ÿä¸€é¡¹ç›®åç§° `infra`

### 3. å¥åº·æ£€æŸ¥
- âœ… **æœåŠ¡çŠ¶æ€**ï¼šè‡ªåŠ¨æ£€æŸ¥å®¹å™¨è¿è¡ŒçŠ¶æ€
- âœ… **å¯åŠ¨ç­‰å¾…**ï¼šç­‰å¾…æœåŠ¡å®Œå…¨å¯åŠ¨
- âœ… **é”™è¯¯æŠ¥å‘Š**ï¼šè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

## ğŸ”§ ç®¡ç†å‘½ä»¤

### æœåŠ¡ç®¡ç†
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
docker compose -p infra ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker compose -p infra logs nginx
docker compose -p infra logs -f mysql

# é‡å¯æœåŠ¡
docker compose -p infra restart redis

# åœæ­¢/å¯åŠ¨
docker compose -p infra stop mongo
docker compose -p infra start mongo
```

### æ•…éšœæ’é™¤
```bash
# æ£€æŸ¥é…ç½®
docker compose -p infra config

# æ£€æŸ¥ç”¨æˆ·æƒé™
groups www
id www

# æ£€æŸ¥æ•°æ®ç›®å½•
ls -la /data/
```

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### 1. å®‰è£…å‰å‡†å¤‡
```bash
# ç¡®ä¿ www ç”¨æˆ·å­˜åœ¨å¹¶åœ¨ docker ç»„ä¸­
sudo usermod -aG docker www
su - www  # åˆ·æ–°æƒé™
```

### 2. æ¨èå®‰è£…é¡ºåº
```bash
bash install-nginx.sh    # 1. Web æœåŠ¡
bash install-mysql.sh    # 2. ä¸»æ•°æ®åº“
bash install-redis.sh    # 3. ç¼“å­˜
bash install-mongo.sh    # 4. NoSQLï¼ˆå¯é€‰ï¼‰
bash install-kafka.sh    # 5. æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¯é€‰ï¼‰
```

### 3. ç”Ÿäº§ç¯å¢ƒ
- âœ… ä½¿ç”¨ `www` ç”¨æˆ·
- âœ… å®šæœŸå¤‡ä»½ `/data` ç›®å½•
- âœ… ç›‘æ§æœåŠ¡çŠ¶æ€
- âœ… é…ç½®é˜²ç«å¢™è§„åˆ™

## ğŸ‰ ä¼˜åŠ¿ç‰¹ç‚¹

### 1. **å®Œå…¨è‡ªåŠ¨åŒ–**
- è‡ªåŠ¨åˆ›å»ºç›®å½•å’Œè®¾ç½®æƒé™
- è‡ªåŠ¨ç”Ÿæˆé…ç½®æ–‡ä»¶å’Œå¯†ç 
- è‡ªåŠ¨å¥åº·æ£€æŸ¥å’Œé”™è¯¯å¤„ç†

### 2. **ç”Ÿäº§å°±ç»ª**
- é root ç”¨æˆ·è¿è¡Œ
- åˆç†çš„å®‰å…¨é…ç½®
- å®Œæ•´çš„æ—¥å¿—ç®¡ç†

### 3. **çµæ´»æ€§å¼º**
- æ”¯æŒå•ç‹¬å®‰è£…ä»»æ„ç»„ä»¶
- æ”¯æŒè‡ªå®šä¹‰ç”¨æˆ·å’Œç›®å½•
- æ”¯æŒé¢„è§ˆæ¨¡å¼

### 4. **ç»´æŠ¤å‹å¥½**
- ç»Ÿä¸€çš„é¡¹ç›®ç®¡ç†
- æ¸…æ™°çš„ç›®å½•ç»“æ„
- æ ‡å‡†çš„ Docker Compose å‘½ä»¤

---

**ä¸‹æ¬¡ä½¿ç”¨åªéœ€ä¸€æ¡å‘½ä»¤å³å¯å®Œæˆæ‰€æœ‰ç»„ä»¶çš„å®‰è£…å’Œé…ç½®ï¼** ğŸš€

*çŠ¶æ€: âœ… å·²å®Œæˆ*