# æœåŠ¡å™¨ç»„ä»¶ - ç½‘ç»œ&åŸºç¡€å·

> ğŸ”§ åˆ›å»º Docker ç½‘ç»œæ¶æ„å’Œæ•°æ®æŒä¹…åŒ–å­˜å‚¨å·

## ğŸ¯ åŸºç¡€è®¾æ–½ç›®æ ‡

- åˆ›å»ºéš”ç¦»çš„ Docker ç½‘ç»œæ¶æ„
- å»ºç«‹æ•°æ®æŒä¹…åŒ–å­˜å‚¨å·
- é…ç½®ç½‘ç»œå®‰å…¨ç­–ç•¥
- è®¾ç½®æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡
- å»ºç«‹ç›‘æ§å’Œæ—¥å¿—æ”¶é›†åŸºç¡€

## ğŸŒ ç½‘ç»œæ¶æ„è®¾è®¡

### ç½‘ç»œæ‹“æ‰‘ç»“æ„

```
                    ğŸŒ External Traffic
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Host Network â”‚
                    â”‚   (ç‰©ç†ç½‘å¡)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚               â”‚               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”      â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ infra-frontend â”‚      â”‚      â”‚  infra-backend  â”‚
    â”‚   (å¯¹å¤–æœåŠ¡)   â”‚      â”‚      â”‚   (å†…éƒ¨æœåŠ¡)    â”‚
    â”‚                â”‚      â”‚      â”‚                 â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚      â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚  Nginx  â”‚   â”‚â—„â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â–ºâ”‚  â”‚   MySQL    â”‚ â”‚
    â”‚  â”‚ (ç½‘å…³)  â”‚   â”‚      â”‚      â”‚  â”‚   Redis    â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚      â”‚      â”‚  â”‚   MongoDB  â”‚ â”‚
    â”‚                â”‚      â”‚      â”‚  â”‚   Kafka    â”‚ â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚      â”‚      â”‚  â”‚   Jenkins  â”‚ â”‚
    â”‚  â”‚  Apps   â”‚   â”‚      â”‚      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚  â”‚ (åº”ç”¨)  â”‚   â”‚      â”‚      â”‚                 â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚      â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
            â”‚               â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”      â”‚
                    â”‚  Docker Host  â”‚      â”‚
                    â”‚   ç½‘ç»œå‘½åç©ºé—´  â”‚      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                                          â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚         æ•°æ®å·å±‚            â”‚
                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                            â”‚  â”‚    infra_mysql_data    â”‚ â”‚
                            â”‚  â”‚    infra_redis_data    â”‚ â”‚
                            â”‚  â”‚    infra_mongo_data    â”‚ â”‚
                            â”‚  â”‚    infra_kafka_data    â”‚ â”‚
                            â”‚  â”‚   infra_jenkins_data   â”‚ â”‚
                            â”‚  â”‚    infra_nginx_conf    â”‚ â”‚
                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç½‘ç»œåˆ†å±‚ç­–ç•¥

| ç½‘ç»œå±‚çº§ | ç½‘ç»œåç§° | ç”¨é€” | è®¿é—®æ§åˆ¶ |
|---------|---------|------|----------|
| **å¯¹å¤–æœåŠ¡** | `infra-frontend` | WebæœåŠ¡ã€APIç½‘å…³ | å…¬ç½‘å¯è®¿é—® |
| **å†…éƒ¨æœåŠ¡** | `infra-backend` | æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ— | ä»…å†…ç½‘è®¿é—® |
| **ç®¡ç†ç½‘ç»œ** | `infra-mgmt` | ç›‘æ§ã€ç®¡ç†ç•Œé¢ | é™åˆ¶è®¿é—® |

## ğŸš€ è‡ªåŠ¨åŒ–éƒ¨ç½²

### ä¸€é”®åŸºç¡€è®¾æ–½åˆ›å»º

```bash
# ä½¿ç”¨ compose-manager è„šæœ¬åˆ›å»ºåŸºç¡€è®¾æ–½
./scripts/deploy/compose-manager.sh infra up core

# è‡ªåŠ¨å®Œæˆï¼š
# âœ… åˆ›å»º Docker ç½‘ç»œ (frontend/backend)
# âœ… åˆ›å»ºæ•°æ®æŒä¹…åŒ–å·
# âœ… è®¾ç½®ç½‘ç»œå®‰å…¨ç­–ç•¥
# âœ… é…ç½®æœåŠ¡å‘ç°
# âœ… éªŒè¯ç½‘ç»œè¿é€šæ€§
```

### éªŒè¯åŸºç¡€è®¾æ–½

```bash
# æ£€æŸ¥ç½‘ç»œåˆ›å»ºçŠ¶æ€
docker network ls | grep infra-

# æ£€æŸ¥æ•°æ®å·åˆ›å»ºçŠ¶æ€
docker volume ls | grep infra_

# æµ‹è¯•ç½‘ç»œè¿é€šæ€§
./scripts/deploy/compose-manager.sh infra test network
```

## ğŸ”§ æ‰‹åŠ¨é…ç½®æ­¥éª¤

### æ­¥éª¤ 1: åˆ›å»º Docker ç½‘ç»œ

```bash
# åˆ›å»ºå‰ç«¯ç½‘ç»œï¼ˆå¯¹å¤–æœåŠ¡ï¼‰
docker network create \
  --driver bridge \
  --subnet=172.20.0.0/16 \
  --ip-range=172.20.1.0/24 \
  --gateway=172.20.0.1 \
  --opt com.docker.network.bridge.name=infra-frontend \
  --opt com.docker.network.driver.mtu=1500 \
  infra-frontend

# åˆ›å»ºåç«¯ç½‘ç»œï¼ˆå†…éƒ¨æœåŠ¡ï¼‰
docker network create \
  --driver bridge \
  --subnet=172.21.0.0/16 \
  --ip-range=172.21.1.0/24 \
  --gateway=172.21.0.1 \
  --opt com.docker.network.bridge.name=infra-backend \
  --opt com.docker.network.driver.mtu=1500 \
  --internal \
  infra-backend

# éªŒè¯ç½‘ç»œåˆ›å»º
docker network ls
docker network inspect infra-frontend
docker network inspect infra-backend
```

### æ­¥éª¤ 2: åˆ›å»ºæ•°æ®æŒä¹…åŒ–å·

```bash
# MySQL æ•°æ®å·
docker volume create \
  --driver local \
  --opt type=none \
  --opt o=bind \
  --opt device=/data/infra/mysql/data \
  infra_mysql_data

# Redis æ•°æ®å·  
docker volume create \
  --driver local \
  --opt type=none \
  --opt o=bind \
  --opt device=/data/infra/redis/data \
  infra_redis_data

# MongoDB æ•°æ®å·
docker volume create \
  --driver local \
  --opt type=none \
  --opt o=bind \
  --opt device=/data/infra/mongo/data \
  infra_mongo_data

# Kafka æ•°æ®å·
docker volume create \
  --driver local \
  --opt type=none \
  --opt o=bind \
  --opt device=/data/infra/kafka/data \
  infra_kafka_data

# Jenkins æ•°æ®å·
docker volume create \
  --driver local \
  --opt type=none \
  --opt o=bind \
  --opt device=/data/infra/jenkins/data \
  infra_jenkins_data

# Nginx é…ç½®å·
docker volume create \
  --driver local \
  --opt type=none \
  --opt o=bind \
  --opt device=/data/infra/nginx/conf \
  infra_nginx_conf
```

### æ­¥éª¤ 3: åˆ›å»ºæ•°æ®ç›®å½•ç»“æ„

```bash
# åˆ›å»ºåŸºç¡€ç›®å½•ç»“æ„
sudo mkdir -p /data/infra/{mysql,redis,mongo,kafka,jenkins,nginx}/{data,conf,logs}

# è®¾ç½®ç›®å½•æƒé™
sudo chown -R admin:wheel /data/infra
sudo chmod -R 755 /data/infra

# MySQL æ•°æ®ç›®å½•æƒé™
sudo chown -R 999:999 /data/infra/mysql/data
sudo chmod 750 /data/infra/mysql/data

# Redis æ•°æ®ç›®å½•æƒé™  
sudo chown -R 999:999 /data/infra/redis/data
sudo chmod 750 /data/infra/redis/data

# MongoDB æ•°æ®ç›®å½•æƒé™
sudo chown -R 999:999 /data/infra/mongo/data
sudo chmod 750 /data/infra/mongo/data

# Kafka æ•°æ®ç›®å½•æƒé™
sudo chown -R 1001:1001 /data/infra/kafka/data
sudo chmod 750 /data/infra/kafka/data

# Jenkins æ•°æ®ç›®å½•æƒé™
sudo chown -R 1000:1000 /data/infra/jenkins/data
sudo chmod 750 /data/infra/jenkins/data

# Nginx é…ç½®ç›®å½•æƒé™
sudo chown -R 101:101 /data/infra/nginx/conf
sudo chmod 750 /data/infra/nginx/conf
```

### æ­¥éª¤ 4: é…ç½®ç½‘ç»œå®‰å…¨ç­–ç•¥

```bash
# åˆ›å»ºç½‘ç»œå®‰å…¨è§„åˆ™è„šæœ¬
sudo tee /usr/local/bin/infra-network-security << 'EOF'
#!/bin/bash

# ç¦æ­¢ frontend ç½‘ç»œè®¿é—®å®¿ä¸»æœºæ•æ„Ÿç«¯å£
iptables -I DOCKER-USER -s 172.20.0.0/16 -d 172.17.0.1 -p tcp --dport 22 -j DROP
iptables -I DOCKER-USER -s 172.20.0.0/16 -d 172.17.0.1 -p tcp --dport 3306 -j DROP

# å…è®¸ frontend åˆ° backend çš„ç‰¹å®šè¿æ¥
iptables -I DOCKER-USER -s 172.20.0.0/16 -d 172.21.0.0/16 -p tcp --dport 3306 -j ACCEPT
iptables -I DOCKER-USER -s 172.20.0.0/16 -d 172.21.0.0/16 -p tcp --dport 6379 -j ACCEPT
iptables -I DOCKER-USER -s 172.20.0.0/16 -d 172.21.0.0/16 -p tcp --dport 27017 -j ACCEPT

# ç¦æ­¢ backend ç½‘ç»œè®¿é—®å¤–ç½‘ï¼ˆé™¤ DNSï¼‰
iptables -I DOCKER-USER -s 172.21.0.0/16 ! -d 172.21.0.0/16 -p tcp --dport 80 -j DROP
iptables -I DOCKER-USER -s 172.21.0.0/16 ! -d 172.21.0.0/16 -p tcp --dport 443 -j DROP
iptables -I DOCKER-USER -s 172.21.0.0/16 ! -d 172.21.0.0/16 -p tcp --dport 53 -j ACCEPT
iptables -I DOCKER-USER -s 172.21.0.0/16 ! -d 172.21.0.0/16 -p udp --dport 53 -j ACCEPT

echo "âœ… Docker ç½‘ç»œå®‰å…¨è§„åˆ™å·²åº”ç”¨"
EOF

sudo chmod +x /usr/local/bin/infra-network-security

# æ‰§è¡Œç½‘ç»œå®‰å…¨é…ç½®
sudo /usr/local/bin/infra-network-security
```

## ğŸ“Š ç½‘ç»œç®¡ç†å’Œç›‘æ§

### ç½‘ç»œä¿¡æ¯æŸ¥çœ‹

```bash
# æŸ¥çœ‹ç½‘ç»œè¯¦æƒ…
docker network ls --format "table {{.Name}}\t{{.Driver}}\t{{.Scope}}"

# æŸ¥çœ‹ç½‘ç»œé…ç½®
docker network inspect infra-frontend --format '{{json .IPAM.Config}}'
docker network inspect infra-backend --format '{{json .IPAM.Config}}'

# æŸ¥çœ‹è¿æ¥çš„å®¹å™¨
docker network inspect infra-frontend --format '{{range $id, $container := .Containers}}{{$container.Name}} {{$container.IPv4Address}}{{"\n"}}{{end}}'
```

### æ•°æ®å·ç®¡ç†

```bash
# æŸ¥çœ‹æ•°æ®å·åˆ—è¡¨
docker volume ls --format "table {{.Name}}\t{{.Driver}}\t{{.Scope}}"

# æŸ¥çœ‹æ•°æ®å·è¯¦æƒ…
docker volume inspect infra_mysql_data --format '{{json .Mountpoint}}'

# æ£€æŸ¥æ•°æ®å·ä½¿ç”¨æƒ…å†µ
docker system df -v | grep infra_
```

### ç½‘ç»œæµ‹è¯•å·¥å…·

```bash
# åˆ›å»ºç½‘ç»œæµ‹è¯•å®¹å™¨
docker run -it --rm \
  --network infra-frontend \
  --name net-test-frontend \
  nicolaka/netshoot

# æµ‹è¯•ç½‘ç»œè¿é€šæ€§
docker exec net-test-frontend ping -c 3 172.21.0.1
docker exec net-test-frontend nslookup mysql.infra-backend
docker exec net-test-frontend telnet redis.infra-backend 6379

# æŸ¥çœ‹ç½‘ç»œè·¯ç”±
docker exec net-test-frontend ip route
docker exec net-test-frontend iptables -L
```

## ğŸ” Docker Compose é…ç½®

### åŸºç¡€ç½‘ç»œå’Œå·å®šä¹‰

```yaml
# compose/infra/docker-compose.yml
version: '3.8'

networks:
  infra-frontend:
    external: true
    name: infra-frontend
  
  infra-backend:
    external: true  
    name: infra-backend

volumes:
  infra_mysql_data:
    external: true
    name: infra_mysql_data
  
  infra_redis_data:
    external: true
    name: infra_redis_data
    
  infra_mongo_data:
    external: true
    name: infra_mongo_data
    
  infra_kafka_data:
    external: true
    name: infra_kafka_data
    
  infra_jenkins_data:
    external: true
    name: infra_jenkins_data
    
  infra_nginx_conf:
    external: true
    name: infra_nginx_conf
```

### æœåŠ¡ç½‘ç»œé…ç½®ç¤ºä¾‹

```yaml
services:
  nginx:
    image: nginx:alpine
    networks:
      - infra-frontend
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - infra_nginx_conf:/etc/nginx

  mysql:
    image: mysql:8.0
    networks:
      - infra-backend
    volumes:
      - infra_mysql_data:/var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
```

## ğŸ“‹ éªŒè¯æ£€æŸ¥æ¸…å•

### âœ… ç½‘ç»œåˆ›å»ºéªŒè¯

```bash
# æ£€æŸ¥ç½‘ç»œæ˜¯å¦å­˜åœ¨
docker network inspect infra-frontend >/dev/null 2>&1 && echo "âœ… frontend ç½‘ç»œåˆ›å»ºæˆåŠŸ" || echo "âŒ frontend ç½‘ç»œåˆ›å»ºå¤±è´¥"
docker network inspect infra-backend >/dev/null 2>&1 && echo "âœ… backend ç½‘ç»œåˆ›å»ºæˆåŠŸ" || echo "âŒ backend ç½‘ç»œåˆ›å»ºå¤±è´¥"

# æ£€æŸ¥ç½‘ç»œé…ç½®
docker network inspect infra-frontend | grep -q '"Internal": false' && echo "âœ… frontend ç½‘ç»œé…ç½®æ­£ç¡®" || echo "âŒ frontend ç½‘ç»œé…ç½®é”™è¯¯"
docker network inspect infra-backend | grep -q '"Internal": true' && echo "âœ… backend ç½‘ç»œéš”ç¦»æ­£ç¡®" || echo "âŒ backend ç½‘ç»œéš”ç¦»é”™è¯¯"
```

### âœ… æ•°æ®å·éªŒè¯

```bash
# æ£€æŸ¥æ•°æ®å·åˆ›å»º
for vol in mysql redis mongo kafka jenkins nginx; do
  docker volume inspect infra_${vol}_data >/dev/null 2>&1 && echo "âœ… ${vol} æ•°æ®å·åˆ›å»ºæˆåŠŸ" || echo "âŒ ${vol} æ•°æ®å·åˆ›å»ºå¤±è´¥"
done

# æ£€æŸ¥ç›®å½•æƒé™
ls -ld /opt/infra/*/data | while read perm links owner group size month day time dir; do
  [[ $perm == d*750 ]] && echo "âœ… $dir æƒé™æ­£ç¡® ($perm)" || echo "âŒ $dir æƒé™é”™è¯¯ ($perm)"
done
```

### âœ… ç½‘ç»œå®‰å…¨éªŒè¯

```bash
# æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
sudo iptables -L DOCKER-USER | grep -q "172.20.0.0/16" && echo "âœ… ç½‘ç»œå®‰å…¨è§„åˆ™å·²åº”ç”¨" || echo "âŒ ç½‘ç»œå®‰å…¨è§„åˆ™æœªåº”ç”¨"

# æµ‹è¯•ç½‘ç»œéš”ç¦»
docker run --rm --network infra-backend nicolaka/netshoot ping -c 1 -W 1 8.8.8.8 >/dev/null 2>&1 && echo "âŒ backend ç½‘ç»œéš”ç¦»å¤±è´¥" || echo "âœ… backend ç½‘ç»œéš”ç¦»æˆåŠŸ"
```

## ğŸš¨ æ•…éšœæ’é™¤

### ç½‘ç»œè¿æ¥é—®é¢˜

```bash
# é—®é¢˜ 1: å®¹å™¨æ— æ³•è¿æ¥åˆ°ç½‘ç»œ
# æŸ¥çœ‹ç½‘ç»œé©±åŠ¨çŠ¶æ€
docker network ls
sudo systemctl status docker

# é‡æ–°åˆ›å»ºç½‘ç»œ
docker network rm infra-frontend infra-backend
# é‡æ–°æ‰§è¡Œç½‘ç»œåˆ›å»ºæ­¥éª¤

# é—®é¢˜ 2: ç½‘ç»œ IP å†²çª
# æŸ¥çœ‹ç°æœ‰ç½‘ç»œ IP åˆ†é…
docker network ls --format "table {{.Name}}\t{{.Driver}}"
docker network inspect $(docker network ls -q) | grep Subnet

# ä¿®æ”¹ç½‘ç»œ IP æ®µ
# ç¼–è¾‘ç½‘ç»œé…ç½®ï¼Œä½¿ç”¨ä¸åŒçš„ IP æ®µ
```

### æ•°æ®å·é—®é¢˜

```bash
# é—®é¢˜ 3: æ•°æ®å·æŒ‚è½½å¤±è´¥
# æ£€æŸ¥ç›®å½•å­˜åœ¨å’Œæƒé™
ls -ld /opt/infra/*/data
sudo chown -R admin:wheel /opt/infra

# æ£€æŸ¥æ•°æ®å·çŠ¶æ€
docker volume inspect infra_mysql_data
docker volume ls --filter dangling=true

# é‡æ–°åˆ›å»ºæ•°æ®å·
docker volume rm infra_mysql_data
# é‡æ–°æ‰§è¡Œæ•°æ®å·åˆ›å»ºæ­¥éª¤
```

### æƒé™é—®é¢˜

```bash
# é—®é¢˜ 4: å®¹å™¨å¯åŠ¨æƒé™é”™è¯¯
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs container_name

# ä¿®å¤ç›®å½•æƒé™
sudo chown -R 999:999 /opt/infra/mysql/data
sudo chown -R 1001:1001 /opt/infra/kafka/data
sudo chown -R 1000:1000 /opt/infra/jenkins/data

# æ£€æŸ¥ SELinuxï¼ˆå¦‚æœå¯ç”¨ï¼‰
getenforce
sudo setsebool -P container_manage_cgroup on
```

## ğŸ”§ é«˜çº§é…ç½®

### ç½‘ç»œæ€§èƒ½ä¼˜åŒ–

```bash
# ä¼˜åŒ–ç½‘ç»œ MTU
docker network create \
  --opt com.docker.network.driver.mtu=9000 \
  --subnet=172.22.0.0/16 \
  infra-jumbo

# å¯ç”¨ç½‘ç»œåŠ é€Ÿ
echo 'net.core.default_qdisc = fq_codel' | sudo tee -a /etc/sysctl.conf
echo 'net.ipv4.tcp_congestion_control = bbr' | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```

### æ•°æ®å·å¤‡ä»½ç­–ç•¥

```bash
# åˆ›å»ºæ•°æ®å¤‡ä»½è„šæœ¬
sudo tee /usr/local/bin/infra-backup << 'EOF'
#!/bin/bash
BACKUP_DIR="/opt/backups/infra/$(date +%Y%m%d)"
mkdir -p $BACKUP_DIR

# å¤‡ä»½ MySQL
docker exec mysql mysqldump --all-databases --routines --triggers > $BACKUP_DIR/mysql-backup.sql

# å¤‡ä»½ Redis
docker exec redis redis-cli BGSAVE
docker cp redis:/data/dump.rdb $BACKUP_DIR/

# å¤‡ä»½ MongoDB
docker exec mongo mongodump --out $BACKUP_DIR/mongo-backup

# å¤‡ä»½é…ç½®æ–‡ä»¶
tar -czf $BACKUP_DIR/configs.tar.gz /opt/infra/*/conf

echo "âœ… å¤‡ä»½å®Œæˆ: $BACKUP_DIR"
EOF

sudo chmod +x /usr/local/bin/infra-backup

# è®¾ç½®å®šæ—¶å¤‡ä»½
echo "0 2 * * * /usr/local/bin/infra-backup" | sudo crontab -
```

### ç½‘ç»œç›‘æ§

```bash
# å®‰è£…ç½‘ç»œç›‘æ§å·¥å…·
docker run -d \
  --name network-monitor \
  --network infra-frontend \
  --restart unless-stopped \
  -v /proc:/host/proc:ro \
  -v /sys:/host/sys:ro \
  prom/node-exporter \
    --path.procfs=/host/proc \
    --path.sysfs=/host/sys \
    --collector.filesystem.ignored-mount-points \
    "^/(sys|proc|dev|host|etc|rootfs/var/lib/docker/containers|rootfs/var/lib/docker/overlay2|rootfs/run/docker/netns|rootfs/var/lib/docker/aufs)($$|/)"
```

## ğŸ”„ ä¸‹ä¸€æ­¥

ç½‘ç»œå’ŒåŸºç¡€å·é…ç½®å®Œæˆåï¼Œè¯·æŒ‰æ¨èé¡ºåºéƒ¨ç½²æœåŠ¡ï¼š

1. [ğŸ—„ï¸ å­˜å‚¨æœåŠ¡](æœåŠ¡å™¨ç»„ä»¶--å­˜å‚¨æœåŠ¡(MySQL_Redis_MongoDB).md) - éƒ¨ç½² MySQL/Redis/MongoDB
2. [ğŸ“¨ æ¶ˆæ¯æœåŠ¡](æœåŠ¡å™¨ç»„ä»¶--æ¶ˆæ¯æœåŠ¡(Kafka).md) - éƒ¨ç½² Kafka æ¶ˆæ¯é˜Ÿåˆ—
3. [ğŸ”§ CI/CDæœåŠ¡](æœåŠ¡å™¨ç»„ä»¶--CI_CD(Jenkins).md) - éƒ¨ç½² Jenkins å¹³å°
4. [ğŸŒ ç½‘å…³æœåŠ¡](æœåŠ¡å™¨ç»„ä»¶--ç½‘å…³(Nginx).md) - éƒ¨ç½² Nginx ç½‘å…³

---

> ğŸ’¡ **ç½‘ç»œæ¶æ„æé†’**:
> - å®šæœŸæ£€æŸ¥ç½‘ç»œå®‰å…¨è§„åˆ™çš„æœ‰æ•ˆæ€§
> - ç›‘æ§æ•°æ®å·çš„ç£ç›˜ä½¿ç”¨æƒ…å†µ
> - å¤‡ä»½é‡è¦æ•°æ®å·å’Œç½‘ç»œé…ç½®
> - ä¿æŒç½‘ç»œæ‹“æ‰‘æ–‡æ¡£çš„æ›´æ–°
> - å®šæœŸæµ‹è¯•ç½‘ç»œéš”ç¦»å’Œè¿é€šæ€§