# Jenkins ç»„ä»¶æ·»åŠ å®ŒæˆæŠ¥å‘Š

## ğŸ‰ Jenkins CI/CD å¹³å°é›†æˆæˆåŠŸ

### ğŸ“‹ å®Œæˆçš„å·¥ä½œ

#### 1. Jenkins ç»„ä»¶é…ç½®
- âœ… **Docker Compose é…ç½®** (`components/jenkins/override.yml`)
  - Jenkins LTS ç‰ˆæœ¬
  - ç«¯å£æ˜ å°„ï¼š8080 (Web), 50000 (Agent)
  - Docker socket æŒ‚è½½ï¼Œæ”¯æŒ Docker æ„å»º
  - é…ç½®æ–‡ä»¶å’Œæ•°æ®æŒä¹…åŒ–

- âœ… **Configuration as Code** (`components/jenkins/jenkins.yaml`)
  - è‡ªåŠ¨åŒ– Jenkins é…ç½®
  - é¢„ç½®ç®¡ç†å‘˜ç”¨æˆ·
  - å®‰å…¨ç­–ç•¥é…ç½®
  - Docker æ’ä»¶é›†æˆ
  - ç¤ºä¾‹æµæ°´çº¿ä½œä¸š

- âœ… **æ’ä»¶é¢„å®‰è£…** (`components/jenkins/plugins.txt`)
  - æ ¸å¿ƒæ’ä»¶ï¼šPipeline, Git, Docker
  - æ„å»ºå·¥å…·ï¼šMaven, Gradle, Node.js
  - è´¨é‡æ’ä»¶ï¼šJUnit, JaCoCo, SonarQube
  - UI æ’ä»¶ï¼šBlue Ocean
  - é›†æˆæ’ä»¶ï¼šSlack, JIRA ç­‰

#### 2. å®‰è£…è„šæœ¬
- âœ… **ç‹¬ç«‹å®‰è£…è„šæœ¬** (`install-jenkins.sh`)
  - å®Œæ•´çš„ Jenkins å®‰è£…å’Œé…ç½®
  - æ”¯æŒé…ç½®ç”Ÿæˆã€æœåŠ¡å¯åŠ¨ã€çŠ¶æ€æ£€æŸ¥
  - è‡ªåŠ¨åˆ›å»ºç›®å½•ç»“æ„å’Œè®¾ç½®æƒé™
  - è¯¦ç»†çš„å¸®åŠ©ä¿¡æ¯å’Œé”™è¯¯å¤„ç†

- âœ… **é›†æˆåˆ°ç»„ä»¶å®‰è£…ç³»ç»Ÿ**
  - æ·»åŠ åˆ°äº¤äº’å¼é€‰æ‹©èœå•
  - ç¯å¢ƒé…ç½®è‡ªåŠ¨ç”Ÿæˆ
  - æ”¯æŒå‘½ä»¤è¡Œå’Œäº¤äº’å¼å®‰è£…

#### 3. æ–‡æ¡£å’Œè¯´æ˜
- âœ… **ç»„ä»¶è¯´æ˜æ–‡æ¡£** (`components/jenkins/README.md`)
  - è¯¦ç»†çš„åŠŸèƒ½ä»‹ç»
  - é…ç½®è¯´æ˜å’Œä½¿ç”¨æŒ‡å—
  - æ•…éšœæ’é™¤å’Œæ‰©å±•æ–¹æ³•

### ğŸš€ Jenkins åŠŸèƒ½ç‰¹æ€§

#### å¼€ç®±å³ç”¨ç‰¹æ€§
- **Configuration as Code (CasC)**ï¼šé€šè¿‡ YAML æ–‡ä»¶è‡ªåŠ¨é…ç½®
- **æ’ä»¶é¢„å®‰è£…**ï¼šé›†æˆ 60+ å¸¸ç”¨æ’ä»¶ï¼Œæ— éœ€æ‰‹åŠ¨å®‰è£…
- **Docker é›†æˆ**ï¼šç›´æ¥ä½¿ç”¨å®¿ä¸»æœº Docker è¿›è¡Œæ„å»º
- **å®‰å…¨é…ç½®**ï¼šé»˜è®¤ç¦ç”¨åŒ¿åè®¿é—®ï¼Œç®¡ç†å‘˜è´¦æˆ·ä¿æŠ¤
- **æµæ°´çº¿æ”¯æŒ**ï¼šé¢„ç½®ç¤ºä¾‹æµæ°´çº¿ï¼Œæ”¯æŒå£°æ˜å¼è¯­æ³•

#### æœåŠ¡é…ç½®
```bash
# è®¿é—®ä¿¡æ¯
Web ç•Œé¢: http://localhost:8080
Agent ç«¯å£: 50000

# é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·
ç”¨æˆ·å: admin
å¯†ç : æŸ¥çœ‹ .env æ–‡ä»¶ä¸­çš„ JENKINS_ADMIN_PASSWORD

# ç›®å½•ç»“æ„
/data/jenkins/jenkins_home/     # Jenkins ä¸»ç›®å½•
/data/jenkins/casc_configs/     # CasC é…ç½®
/data/jenkins/logs/             # æ—¥å¿—æ–‡ä»¶
```

### ğŸ¯ ä½¿ç”¨æ–¹å¼

#### 1. ç‹¬ç«‹å®‰è£…
```bash
# å®Œæ•´å®‰è£… Jenkins
./scripts/init-server/install-jenkins.sh

# ä»…ç”Ÿæˆé…ç½®æ–‡ä»¶
./scripts/init-server/install-jenkins.sh --config-only

# æ£€æŸ¥è¿è¡ŒçŠ¶æ€
./scripts/init-server/install-jenkins.sh --status

# æŸ¥çœ‹æ—¥å¿—
./scripts/init-server/install-jenkins.sh --logs
```

#### 2. é€šè¿‡ç»„ä»¶å®‰è£…è„šæœ¬
```bash
# å‘½ä»¤è¡Œå®‰è£…
./scripts/init-server/install-components.sh jenkins

# äº¤äº’å¼å®‰è£…
./scripts/init-server/install-components.sh --interactive
# ç„¶åé€‰æ‹©ç¬¬ 6 é¡¹ Jenkins
```

### ğŸ“Š ç»„ä»¶æ¦‚è§ˆæ›´æ–°

ç°åœ¨æ”¯æŒçš„å®Œæ•´ç»„ä»¶åˆ—è¡¨ï¼š

| ç»„ä»¶ | ç”¨é€” | ç«¯å£ | èµ„æºå ç”¨ | çŠ¶æ€ |
|------|------|------|----------|------|
| Nginx | Web æœåŠ¡å™¨ | 80/443 | ~128MB | âœ… |
| MySQL | å…³ç³»å‹æ•°æ®åº“ | 3306 | ~1.2GB | âœ… |
| Redis | å†…å­˜ç¼“å­˜ | 6379 | ~256MB | âœ… |
| MongoDB | NoSQL æ•°æ®åº“ | 27017 | ~512MB | âœ… |
| Kafka | æ¶ˆæ¯é˜Ÿåˆ— | 9092/2181 | ~1GB | âœ… |
| **Jenkins** | **CI/CD å¹³å°** | **8080/50000** | **~512MB** | **âœ… æ–°å¢** |

### ğŸ¨ æ¨èç»„åˆ

æ›´æ–°åçš„ç»„ä»¶ç»„åˆå»ºè®®ï¼š

- **Web åº”ç”¨**ï¼šnginx + mysql + redis
- **API æœåŠ¡**ï¼šnginx + mysql + redis + mongo  
- **å¾®æœåŠ¡æ¶æ„**ï¼šnginx + mysql + redis + kafka
- **å…¨æ ˆå¼€å‘**ï¼šnginx + mysql + redis + mongo + kafka + jenkins
- **CI/CD ç¯å¢ƒ**ï¼šjenkins + mysql + redisï¼ˆç”¨äºæ„å»ºå’Œæµ‹è¯•ï¼‰

### ğŸ”§ æŠ€æœ¯å®ç°

#### é›†æˆæ–¹å¼
1. **åŸºç¡€æœåŠ¡å®šä¹‰**ï¼šå·²å­˜åœ¨äº `compose/base/docker-compose.yml`
2. **ç»„ä»¶é…ç½®**ï¼šé€šè¿‡ `override.yml` è¿›è¡ŒèŠ‚ç‚¹ç‰¹å®šé…ç½®
3. **ç¯å¢ƒå˜é‡**ï¼šè‡ªåŠ¨ç”ŸæˆåŒ…å«éšæœºå¯†ç çš„ `.env` æ–‡ä»¶
4. **å®‰è£…è„šæœ¬**ï¼šæ”¯æŒç‹¬ç«‹å®‰è£…å’Œé›†æˆå®‰è£…ä¸¤ç§æ–¹å¼

#### é…ç½®ç®¡ç†
- Jenkins é…ç½®å®Œå…¨é€šè¿‡ CasC ç®¡ç†ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
- æ’ä»¶åˆ—è¡¨å¯é€šè¿‡ä¿®æ”¹ `plugins.txt` è¿›è¡Œå®šåˆ¶
- æµæ°´çº¿å’Œä½œä¸šå¯é€šè¿‡ CasC é¢„ç½®æˆ–åç»­æ·»åŠ 

### âœ… éªŒè¯ç»“æœ

- âœ… ç»„ä»¶å®‰è£…è„šæœ¬æ­£ç¡®è¯†åˆ« Jenkins
- âœ… äº¤äº’å¼èœå•æ˜¾ç¤º Jenkins é€‰é¡¹
- âœ… ç¯å¢ƒé…ç½®æ­£ç¡®ç”Ÿæˆ
- âœ… Docker Compose æ–‡ä»¶é…ç½®å®Œæ•´
- âœ… å¸®åŠ©ä¿¡æ¯å’Œæ–‡æ¡£å®Œå–„

### ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

1. **å®é™…éƒ¨ç½²æµ‹è¯•**ï¼šåœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯ Jenkins å®Œæ•´å®‰è£…æµç¨‹
2. **æµæ°´çº¿æ¨¡æ¿**ï¼šæ ¹æ®å®é™…é¡¹ç›®éœ€æ±‚æ·»åŠ æ›´å¤šæµæ°´çº¿æ¨¡æ¿
3. **æ’ä»¶ä¼˜åŒ–**ï¼šæ ¹æ®ä½¿ç”¨æƒ…å†µè°ƒæ•´é¢„è£…æ’ä»¶åˆ—è¡¨
4. **å®‰å…¨åŠ å›º**ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­é…ç½® HTTPS å’Œæ›´ä¸¥æ ¼çš„å®‰å…¨ç­–ç•¥

## ğŸ“ æ€»ç»“

Jenkins CI/CD å¹³å°å·²æˆåŠŸé›†æˆåˆ° Docker ç»„ä»¶å®‰è£…ç³»ç»Ÿä¸­ï¼Œç°åœ¨ç”¨æˆ·å¯ä»¥ï¼š

- é€šè¿‡äº¤äº’å¼ç•Œé¢é€‰æ‹©å’Œå®‰è£… Jenkins
- ä½¿ç”¨ç‹¬ç«‹è„šæœ¬è¿›è¡Œ Jenkins çš„å®Œæ•´é…ç½®
- è·å¾—å¼€ç®±å³ç”¨çš„ CI/CD ç¯å¢ƒï¼Œæ”¯æŒ Docker æ„å»º
- é€šè¿‡ Configuration as Code è¿›è¡Œè‡ªåŠ¨åŒ–é…ç½®ç®¡ç†

æ•´ä¸ªç³»ç»Ÿç°åœ¨æä¾›äº†ä»åŸºç¡€æœåŠ¡åˆ° CI/CD çš„å®Œæ•´æŠ€æœ¯æ ˆæ”¯æŒï¼ğŸ‰